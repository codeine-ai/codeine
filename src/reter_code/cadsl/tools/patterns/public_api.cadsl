# find_public_api - Find all public API entities in the codebase
#
# Identifies public classes and functions (non-underscore prefixed).

detector find_public_api(category="patterns", severity="info") {
    """Find all public API entities in the codebase."""

    param limit: int = 100;

    reql {
        SELECT ?e ?name ?file ?line ?docstring
        WHERE {
            { ?e type class }
            UNION
            { ?e type function }
            ?e has-name ?name .
            ?e is-in-file ?file .
            ?e is-at-line ?line .
            OPTIONAL { ?e has-docstring ?docstring }
            FILTER ( !REGEX(?name, "^_") && REGEX(?file, "[.]py$") )
        }
        ORDER BY ?file ?name
        LIMIT {limit}
    }
    | select { name, file, line, docstring }
    | emit { findings }
}
